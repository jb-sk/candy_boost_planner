---
description: 現在の変更に基づいてコミットメッセージを生成する
---

1. 変更内容を分析する:
   - **引数に `amend` が指定された場合**:
     - これは `git commit --amend` 用のメッセージ生成である。
     - 「直前のコミットメッセージ（履歴から取得）」と「現在の追加変更」を統合し、1つのまとまったメッセージを作成する意図であると解釈する。
   - 通常の場合:
     - 直前の会話内容や作業履歴から、変更された内容とその目的を特定する。
   - **原則としてツール（`git status` 等）は使用せず、即座に生成する（速度優先）。**

2. コミット対象の選別（脳内フィルタリング）:
   - **「成果物（コード・設定）」と「作業メモ（ドラフト・個人用メモ）」が混在している場合、明示的な指示がない限り「成果物」のみをコミット対象とする。**
   - 特に以下のパスは、ユーザーから指定がない限りコミット対象外（除外）とみなす：
     - `.agent/` 配下のすべてのファイル（ただし `workflows/` ディレクトリ配下は除く）
     - `_local/` などのユーザーディレクトリ
     - コメントアウトされた実験コード

3. Conventional Commits 仕様に従ってコミットメッセージを生成する（**日本語で記述すること**）:
   - **`amend` の場合**: 既存のメッセージ箇条書きに、今回の変更点をマージし、重複を整理して一本化する。
   - **ヘッダー**: `type(scope): subject` (例: `feat(core): 新機能追加`, `fix(auth): ログインロジック修正`, `chore(docs): README更新`)
   - **本文**: *何* を *なぜ* 変更したかを説明する詳細な箇条書きリスト（日本語）。
   - **重要禁止事項**:
     - **ファイル名をバッククォート（`）で囲まないこと**（例: `filename.md` ではなく filename.md と書く）。
       - 理由: IDEの自動リンク機能（CCI）が誤作動するのを防ぐため、プレーンテキストとして記述する。
     - いかなる場合も Markdown のリンク構文 `[...]` を使用しないこと。
     - コミット対象外（フィルタリング済み）の内容をメッセージに含めないこと。

4. 結果を明確に出力する:
   - ユーザーが簡単にコピー＆ペーストできるように、コミットメッセージを **プレーンテキストのコードブロック** (```text) で提示する。
